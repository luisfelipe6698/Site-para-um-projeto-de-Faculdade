<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Eu sou Ninja</title>
<style>
:root{
  --bg:#0f172a; --panel:#111827; --muted:#1f2937;
  --text:#e5e7eb; --accent:#60a5fa; --danger:#ef4444; --ok:#10b981;
  --radius:12px;
}
body{margin:0; font-family:sans-serif; background:var(--bg); color:var(--text);}
header{padding:12px 20px; background:var(--panel);}
header h1{margin:0; font-size:20px;}
nav{display:flex; gap:12px; margin-top:10px;}
nav button{padding:6px 10px; border:none; border-radius:6px; cursor:pointer; background:var(--muted); color:var(--text);}
nav button.active{background:var(--accent);}
section{max-width:800px; margin:20px auto; padding:20px; background:var(--panel); border-radius:var(--radius); display:none;}
section.active{display:block;}
input, select{width:100%; padding:8px; margin:6px 0 12px 0; border:none; border-radius:6px; background:var(--muted); color:var(--text);}
.actions{display:flex; gap:10px; flex-wrap:wrap;}
.btn{flex:1; padding:8px; border:none; border-radius:6px; cursor:pointer; font-weight:bold;}
.btn.primary{background:var(--ok); color:#062b12;}
.btn.secondary{background:var(--accent); color:#062b12;}
.btn.danger{background:var(--danger); color:#fff;}
table{width:100%; border-collapse: collapse;}
th,td{padding:8px; border-bottom:1px solid rgba(255,255,255,.2);}
.badge{padding:4px 6px; border-radius:6px; font-size:12px;}
.badge.ok{background:rgba(16,185,129,.2); color:#10b981;}
.badge.no{background:rgba(239,68,68,.2); color:#ef4444;}
</style>
</head>
<body>

<header>
  <h1>Eu sou Ninja</h1>
  <nav id="menuNav"></nav>
</header>

<!-- Login / Cadastro Usuário -->
<section id="tela-login" class="active">
  <h2>Login</h2>
  <form id="formLogin">
    <input id="loginEmail" type="email" placeholder="E-mail" required>
    <input id="loginSenha" type="password" placeholder="Senha" required>
    <div class="actions">
      <button class="btn primary" type="submit">Entrar</button>
      <button class="btn secondary" type="button" id="btnEsqueci">Esqueci minha senha</button>
    </div>
    <p id="hintLogin"></p>
  </form>
  <hr>
  <h3>Novo usuário</h3>
  <form id="formUsuario">
    <input id="usuarioNome" type="text" placeholder="Nome" required>
    <input id="usuarioEmail" type="email" placeholder="E-mail" required>
    <input id="usuarioSenha" type="password" placeholder="Senha" required>
    <select id="usuarioTipo" required>
      <option value="">Selecione Tipo</option>
      <option>Professor</option>
      <option>Secretária</option>
    </select>
    <div class="actions">
      <button class="btn primary" type="submit">Cadastrar</button>
    </div>
    <p id="hintUsuario"></p>
  </form>
</section>

<!-- Cadastro Aluno -->
<section id="tela-cadastro-aluno">
  <h2>Cadastro de Aluno</h2>
  <form id="formAluno">
    <input type="hidden" id="alunoId">
    <input id="alunoNome" type="text" placeholder="Nome" required>
    <input id="alunoMatricula" type="text" placeholder="Matrícula" required>
    <input id="alunoTurma" type="text" placeholder="Turma" required>
    <div class="actions">
      <button class="btn primary" type="submit">Salvar</button>
      <button class="btn secondary" type="button" id="btnCancelarAluno">Cancelar</button>
    </div>
    <p id="hintAluno"></p>
  </form>
</section>

<!-- Consulta Alunos -->
<section id="tela-consulta-alunos">
  <h2>Consulta de Alunos</h2>
  <input id="buscaAluno" type="text" placeholder="Buscar por nome ou matrícula">
  <button class="btn secondary" id="btnNovoAluno">+ Novo aluno</button>
  <table>
    <thead>
      <tr><th>Nome</th><th>Matrícula</th><th>Turma</th><th>Ações</th></tr>
    </thead>
    <tbody id="tbodyAlunos"></tbody>
  </table>
</section>

<!-- Registro Faltas -->
<section id="tela-registro-faltas">
  <h2>Registro de Faltas</h2>
  <form id="formFalta">
    <select id="faltaAluno" required></select>
    <input id="faltaData" type="date" required>
    <label><input type="radio" name="situacao" value="PRESENCA" checked> Presença</label>
    <label><input type="radio" name="situacao" value="FALTA"> Falta</label>
    <div class="actions">
      <button class="btn primary" type="submit">Registrar</button>
    </div>
    <p id="hintFalta"></p>
  </form>
</section>

<!-- Histórico Faltas -->
<section id="tela-historico-faltas">
  <h2>Histórico de Faltas</h2>
  <select id="histAluno"><option value="">Todos</option></select>
  <input id="histTurma" type="text" placeholder="Turma">
  <input id="histDe" type="date">
  <input id="histAte" type="date">
  <div class="actions">
    <button class="btn secondary" id="btnFiltrarHist">Filtrar</button>
    <button class="btn" id="btnLimparHist">Limpar</button>
  </div>
  <table>
    <thead><tr><th>Data</th><th>Aluno</th><th>Matrícula</th><th>Turma</th><th>Situação</th></tr></thead>
    <tbody id="tbodyHistorico"></tbody>
  </table>
</section>

<!-- Relatórios -->
<section id="tela-relatorios">
  <h2>Relatórios</h2>
  <input id="repDe" type="date">
  <input id="repAte" type="date">
  <button class="btn secondary" id="btnGerarRel">Gerar Relatórios</button>
  <h3>Por Aluno</h3>
  <table>
    <thead><tr><th>Aluno</th><th>Turma</th><th>Presenças</th><th>Faltas</th></tr></thead>
    <tbody id="tbodyRepAluno"></tbody>
  </table>
  <h3>Por Turma</h3>
  <table>
    <thead><tr><th>Turma</th><th>Presenças</th><th>Faltas</th></tr></thead>
    <tbody id="tbodyRepTurma"></tbody>
  </table>
</section>

<script>
const state={logged:false, users:JSON.parse(localStorage.getItem("usuarios")||"[]"), alunos:[], faltas:[]};
let seqAluno=1, seqFalta=1;

const $=sel=>document.querySelector(sel);
const $$=sel=>Array.from(document.querySelectorAll(sel));

function setScreen(id){
  $$('section').forEach(s=>s.classList.toggle('active', s.id===id));
  $$('nav button').forEach(b=>b.classList.toggle('active', b.dataset.target===id));
  if(id==='tela-consulta-alunos') renderAlunos();
  if(id==='tela-registro-faltas') fillCombos();
  if(id==='tela-historico-faltas') renderHistorico();
}
function setupNav(){
  const items=[
    {id:'tela-cadastro-aluno', label:'Cadastro Aluno'},
    {id:'tela-consulta-alunos', label:'Consulta Alunos'},
    {id:'tela-registro-faltas', label:'Registro Faltas'},
    {id:'tela-historico-faltas', label:'Histórico'},
    {id:'tela-relatorios', label:'Relatórios'}
  ];
  $('#menuNav').innerHTML=items.map(i=>`<button data-target="${i.id}">${i.label}</button>`).join('');
  $$('nav button').forEach(b=>b.addEventListener('click',()=>setScreen(b.dataset.target)));
}

// Login
$('#formLogin').addEventListener('submit',e=>{
  e.preventDefault();
  const email=$('#loginEmail').value;
  const senha=$('#loginSenha').value;
  const u=state.users.find(x=>x.email===email&&x.senha===senha);
  if(u){state.logged=true; $('#hintLogin').textContent='Login OK'; setupNav(); setScreen('tela-consulta-alunos');}
  else $('#hintLogin').textContent='E-mail ou senha inválidos!';
});

// Esqueci
$('#btnEsqueci').addEventListener('click',()=>{
  const email=prompt("Digite seu e-mail:");
  if(!email) return;
  const u=state.users.find(x=>x.email===email);
  if(u) alert(`Link de recuperação enviado para ${email}`);
  else alert("E-mail não cadastrado!");
});

// Cadastro Usuário
$('#formUsuario').addEventListener('submit',e=>{
  e.preventDefault();
  const nome=$('#usuarioNome').value, email=$('#usuarioEmail').value, senha=$('#usuarioSenha').value, tipo=$('#usuarioTipo').value;
  if(state.users.some(x=>x.email===email)){$('#hintUsuario').textContent='E-mail já cadastrado'; return;}
  state.users.push({nome,email,senha,tipo});
  localStorage.setItem("usuarios", JSON.stringify(state.users));
  $('#hintUsuario').textContent='Usuário cadastrado';
  e.target.reset();
});

// Cadastro / Consulta Alunos
$('#btnNovoAluno').addEventListener('click',()=>setScreen('tela-cadastro-aluno'));
$('#formAluno').addEventListener('submit',e=>{
  e.preventDefault();
  const id=$('#alunoId').value;
  const nome=$('#alunoNome').value, matricula=$('#alunoMatricula').value, turma=$('#alunoTurma').value;
  if(id){const a=state.alunos.find(x=>x.id==id); a.nome=nome; a.matricula=matricula; a.turma=turma;}
  else state.alunos.push({id:seqAluno++, nome, matricula, turma});
  $('#formAluno').reset(); $('#alunoId').value=''; setScreen('tela-consulta-alunos');
});
$('#btnCancelarAluno').addEventListener('click',()=>{ $('#formAluno').reset(); $('#alunoId').value=''; setScreen('tela-consulta-alunos');});

function renderAlunos(){
  const busca=$('#buscaAluno').value.toLowerCase();
  $('#tbodyAlunos').innerHTML = state.alunos.filter(a=>a.nome.toLowerCase().includes(busca)||a.matricula.includes(busca))
    .map(a=>`<tr><td>${a.nome}</td><td>${a.matricula}</td><td>${a.turma}</td><td>
      <button class="btn secondary" data-edit="${a.id}">Editar</button>
      <button class="btn danger" data-del="${a.id}">Excluir</button>
    </td></tr>`).join('');
}
$('#buscaAluno').addEventListener('input', renderAlunos);
$('#tbodyAlunos').addEventListener('click',e=>{
  if(e.target.dataset.edit){ const a=state.alunos.find(x=>x.id==e.target.dataset.edit);
    $('#alunoId').value=a.id; $('#alunoNome').value=a.nome; $('#alunoMatricula').value=a.matricula; $('#alunoTurma').value=a.turma;
    setScreen('tela-cadastro-aluno'); }
  if(e.target.dataset.del){ if(confirm('Excluir aluno?')){ state.alunos=state.alunos.filter(x=>x.id!=e.target.dataset.del); renderAlunos(); } }
});

// Registro Faltas
function fillCombos(){ $('#faltaAluno').innerHTML=state.alunos.map(a=>`<option value="${a.id}">${a.nome} (${a.matricula})</option>`).join('');
  $('#histAluno').innerHTML='<option value="">Todos</option>'+state.alunos.map(a=>`<option value="${a.id}">${a.nome}</option>`).join(''); }

$('#formFalta').addEventListener('submit',e=>{
  e.preventDefault();
  const alunoId=+$('#faltaAluno').value, data=$('#faltaData').value, sit=document.querySelector('[name=situacao]:checked').value;
  state.faltas.push({id:seqFalta++,alunoId,data,situacao:sit});
  $('#formFalta').reset(); $('#hintFalta').textContent='Registro salvo';
});

// Histórico
function renderHistorico(){
  const aid=$('#histAluno').value, turma=$('#histTurma').value.toLowerCase(), de=$('#histDe').value, ate=$('#histAte').value;
  $('#tbodyHistorico').innerHTML=state.faltas.filter(f=>{
    const a=state.alunos.find(x=>x.id==f.alunoId);
    if(aid&&a.id!=aid) return false;
    if(turma&&!a.turma.toLowerCase().includes(turma)) return false;
    if(de&&f.data<de) return false;
    if(ate&&f.data>ate) return false;
    return true;
  }).map(f=>{ const a=state.alunos.find(x=>x.id==f.alunoId);
    return `<tr><td>${f.data}</td><td>${a.nome}</td><td>${a.matricula}</td><td>${a.turma}</td>
      <td><span class="badge ${f.situacao==='FALTA'?'no':'ok'}">${f.situacao}</span></td></tr>`; }).join('');
}
$('#btnFiltrarHist').addEventListener('click', renderHistorico);
$('#btnLimparHist').addEventListener('click',()=>{$('#histAluno').value='';$('#histTurma').value='';$('#histDe').value='';$('#histAte').value=''; renderHistorico();});

// Relatórios
$('#btnGerarRel').addEventListener('click',()=>{
  const de=$('#repDe').value, ate=$('#repAte').value;
  // Por Aluno
  $('#tbodyRepAluno').innerHTML=state.alunos.map(a=>{
    const fs=state.faltas.filter(f=>f.alunoId==a.id && (!de||f.data>=de)&&(!ate||f.data<=ate));
    const pres=fs.filter(f=>f.situacao==='PRESENCA').length, falt=fs.filter(f=>f.situacao==='FALTA').length;
    return `<tr><td>${a.nome}</td><td>${a.turma}</td><td>${pres}</td><td>${falt}</td></tr>`;
  }).join('');
  // Por Turma
  const turmas=[...new Set(state.alunos.map(a=>a.turma))];
  $('#tbodyRepTurma').innerHTML=turmas.map(t=>{
    const alunosTurma=state.alunos.filter(a=>a.turma===t);
    const fs=state.faltas.filter(f=>alunosTurma.some(a=>a.id==f.alunoId) && (!de||f.data>=de)&&(!ate||f.data<=ate));
    const pres=fs.filter(f=>f.situacao==='PRESENCA').length, falt=fs.filter(f=>f.situacao==='FALTA').length;
    return `<tr><td>${t}</td><td>${pres}</td><td>${falt}</td></tr>`;
  }).join('');
});

// Inicial
setScreen('tela-login');
</script>

</body>
</html>
